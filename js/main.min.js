$(function(){function t(t){var a=$(location).attr("href").split("#")[1]||"fail";sortedTwists=o(t,a),sortedTwists.twists.length===t.twists.length?(t=sortedTwists,e()):i(),$("#twist-list-template-output").html(p(t)),$("#sortable-twist-list").sortable()}function e(){$("#rate,#rate-tab").addClass("active in")}function i(){$("#overview,#overview-tab").addClass("active in")}function o(t,e){twists=t.twists;for(var i=[],o=[],a=0;a<e.length;a++){var r=e.charAt(a),n=twists.filter(function(t){return t.charId===r});1===n.length&&-1===o.indexOf(r)&&(i.push(n[0]),o.push(r))}return{twists:i}}function a(t){$("#twist-overview-template-output").html(l(t)),$(".twist-wrapper").last().css("margin-bottom","70px"),$(".btn-twist").click(function(){var t=$(this).data("id"),e=$(this).data("value");$.ajax({url:"http://twistrating.apiary-mock.com/twists",type:"POST",data:JSON.stringify({id:t,rating:e}),contentType:"application/json; charset=utf-8",dataType:"json"})})}function r(){$(".copy-link").click(function(){$(".link-container").text("http://twistrating.no#"+s()),$(".link-container").attr("href","http://twistrating.no#"+s())})}function n(){$(".share-on-facebook").click(function(){console.log("TwistRating: "+s()),FB.ui({method:"share",href:"http://twistrating.no#"+s()},function(){})})}function s(){var t="";return $("#sortable-twist-list li").each(function(){t+=$(this).data("charid")}),t}n(),r();var l=Handlebars.compile($("#twist-overview-template").html()),p=Handlebars.compile($("#twist-list-template").html());$.getJSON("http://twistrating.apiary-mock.com/twists",function(e){t(e),a(e)}).done(function(){console.log("Lastet ned twist fra APIet")}).fail(function(){alert("Fant ingen twist i APIet... :/")})});