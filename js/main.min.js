function createList(t){var e=$(location).attr("href").split("#")[1]||"fail";sortedTwists=sortTwists(t,e),sortedTwists.twists.length===t.twists.length?(t=sortedTwists,goToOrderPage()):goToOverviewPage(),$("#twist-list-template-output").html(twistListTemplate(t)),$("#sortable-twist-list").sortable()}function goToOrderPage(){$("#rate,#rate-tab").addClass("active in")}function goToOverviewPage(){$("#overview,#overview-tab").addClass("active in")}function sortTwists(t,e){twists=t.twists;for(var o=[],i=[],r=0;r<e.length;r++){var a=e.charAt(r),l=twists.filter(function(t){return t.charId===a});1===l.length&&-1===i.indexOf(a)&&(o.push(l[0]),i.push(a))}return{twists:o}}function createOverview(t){$("#twist-overview-template-output").html(twistOverviewTemplate(t)),$(".twist-wrapper").last().css("margin-bottom","70px"),$(".btn-twist").click(function(){var t=$(this).data("id"),e=$(this).data("value");$.ajax({url:"http://twistrating.apiary-mock.com/twists",type:"POST",data:JSON.stringify({id:t,rating:e}),contentType:"application/json; charset=utf-8",dataType:"json"})})}function createCopyLinkButton(){$(".copy-link").click(function(){$(".link-container").text("http://twistrating.no#"+getTwistOrder()),$(".link-container").attr("href","http://twistrating.no#"+getTwistOrder())})}function createFacebookShareButton(){$(".share-on-facebook").click(function(){console.log("TwistRating: "+getTwistOrder()),FB.ui({method:"share",href:"http://twistrating.no#"+getTwistOrder()},function(){})})}function getTwistOrder(){var t="";return $("#sortable-twist-list li").each(function(){t+=$(this).data("charid")}),t}createFacebookShareButton(),createCopyLinkButton();var twistOverviewTemplate=Handlebars.compile($("#twist-overview-template").html()),twistListTemplate=Handlebars.compile($("#twist-list-template").html());$.getJSON("http://twistrating.apiary-mock.com/twists",function(t){createList(t),createOverview(t)}).done(function(){console.log("Lastet ned twist fra APIet")}).fail(function(){alert("Fant ingen twist i APIet... :/")});